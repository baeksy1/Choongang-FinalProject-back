<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.server.cloud.admin.service.AdminMapper">


	<select id="getTotal" resultType="int">

		select count(*) from NOTICE
		<if test="role!='ROLE_ADMIN'">
		where notice_target=#{role} or notice_target='ALL' 
		</if>


	</select>


	<select id="getList"
		resultType="com.server.cloud.command.NoticeVO">

		select * from NOTICE 
		<if test="role!='ROLE_ADMIN'">
		where notice_target=#{role} or notice_target='ALL' 
		</if>
		order by notice_regdate desc limit
		#{pageStart},#{amount}
	</select>
	<select id="csList" resultType="com.server.cloud.command.CsVO">

		select * from CS order by cs_regdate desc limit #{pageStart},#{amount}
	</select>
	<select id="csTotal" resultType="int">

		select count(*) from CS;


	</select>
	<!-- 회원관리 - 엔지니어 -->


	<select id="adEngineerList" resultType="com.server.cloud.command.EngineerVO">

		select e.*, t.team_id
		from engineer e
		inner join eng_team t on e.team_num = t.team_num
	</select>
	
	<!-- 회원관리 - 기업 -->
	<select id = "adClientList" resultType="com.server.cloud.command.CusVO">
		select c.*, p.pro_status, p.pro_startdate, p.pro_enddate
		from customer c
		join projectinfo p on c.cus_id = p.cus_id;
		
	</select>

	<insert id="csUpdate">
	
	insert into CS(cs_num,cs_answer_yn)
	 value(#{cs_num},#{cs_answer_yn})
	 on duplicate key update
	 cs_num=#{cs_num},cs_answer_yn=#{cs_answer_yn}
	</insert>

	<select id="newProjectList" resultType="com.server.cloud.command.ProjectCusVO">
		select P.PRO_NAME,
			   P.PRO_STARTDATE,
		       P.PRO_STATUS,
		       P.PRO_ID,
		       C.CUS_MANAGET_NAME,
		       CUS_EMAIL
		from PROJECTINFO P
		left join CUSTOMER C ON P.CUS_ID = C.CUS_ID
		where P.TEAM_NUM is null
		limit 5;
	</select>
	
	<select id ="getRequestServer">
  		SELECT S.*,E.ENG_NAME
  		FROM SERVER S 
  		LEFT JOIN ENGINEER E 
  		ON S.ENG_ENID = E.ENG_ENID 
  		WHERE S.PRO_ID=#{pro_id}
  	</select>
  	
  	<select id="getRequestDetail">
  		SELECT * FROM CUSTOMER C
		LEFT JOIN PROJECTINFO P
		ON C.CUS_ID = P.CUS_ID
		WHERE P.PRO_ID=#{pro_id}
  	</select>
  	
  	<select id="getTeamLeader">
  		SELECT ET.TEAM_NUM, ET.TEAM_ID, E.ENG_RANK, E.ENG_NAME
  		FROM ENG_TEAM ET
		LEFT JOIN ENGINEER E ON ET.TEAM_NUM = E.TEAM_NUM
		WHERE ENG_RANK = '팀장';
  	</select>
  	<select id="getTeamMember">
		SELECT ET.TEAM_NUM, ET.TEAM_ID, E.ENG_RANK, E.ENG_NAME 
		FROM ENG_TEAM ET
		LEFT JOIN ENGINEER E ON ET.TEAM_NUM = E.TEAM_NUM
		WHERE ENG_RANK = '팀원';
  	</select>
  	
  	<insert id="inputTeamNum">
  		UPDATE PROJECTINFO SET TEAM_NUM =#{team_num} WHERE PRO_ID =#{pro_id};
  	</insert>
  	
</mapper>

