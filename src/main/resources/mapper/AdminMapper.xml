<?xml version="1.0" encoding="UTF-8"?>



<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.server.cloud.admin.service.AdminMapper">


	<select id="getTotal" resultType="int">

		select count(*) from NOTICE
		<if test="role!='ROLE_ADMIN'">
		where notice_target=#{role} or notice_target='ALL' 
		</if>


	</select>


	<select id="getList"
		resultType="com.server.cloud.command.NoticeVO">

		select * from NOTICE 
		<if test="role!='ROLE_ADMIN'">
		where notice_target=#{role} or notice_target='ALL' 
		</if>
		order by notice_regdate desc limit
		#{pageStart},#{amount}
	</select>
	<select id="csList" resultType="com.server.cloud.command.CsVO">

		select * from CS order by cs_regdate desc limit #{pageStart},#{amount}
	</select>
	<select id="csTotal" resultType="int">

		select count(*) from CS;


	</select>
	<!-- 회원관리 - 엔지니어 -->


	<select id="adEngineerList" resultType="com.server.cloud.command.EngineerVO">

		select e.*, t.team_id
		from engineer e
		inner join eng_team t on e.team_num = t.team_num
	</select>
	
	<!-- 회원관리 - 기업 -->
	<select id = "adClientList" resultType="com.server.cloud.command.CusVO">
		select c.*, p.pro_status, p.pro_startdate, p.pro_enddate
		from customer c
		join projectinfo p on c.cus_id = p.cus_id;
		
	</select>

	<insert id="csUpdate">
	
	insert into CS(cs_num,cs_answer_yn)
	 value(#{cs_num},#{cs_answer_yn})
	 on duplicate key update
	 cs_num=#{cs_num},cs_answer_yn=#{cs_answer_yn}
	</insert>
	
	
	<!-- 프로젝트 리스트 불러오기 -->
	<select id="getProList" resultType="ProjectInfoVO">
		select p.pro_id, p.pro_name, c.cus_company_name, p.pro_rep, p.pro_startdate, p.pro_enddate, p.pro_status, p.pro_pi
		from PROJECTINFO p
		left join CUSTOMER c
		on p.cus_id = c.cus_id;
	</select>
	
	<!-- 프로젝트 디테일 (프로젝트) -->
	<select id="getProListDetail" resultType="ProjectDetailVO">
	  select * from PROJECTINFO p 
	  left join SERVER s 
	  on p.pro_id = s.pro_id
	  left join ENGINEER e
	  on s.eng_enid = e.eng_enid
	  left join ENG_TEAM team
	  on e.team_num = team.team_num
	  where p.pro_id = #{pro_id}
	</select>
	
	<!-- 서버 점검내역 -->
	<select id="getServerInsList" resultType="WorkInfoVO">
     select s.server_id, s.server_name,
     	    w.work_date, w.work_division, w.work_time, w.work_cpu, w.work_ram, w.work_hdd, w.work_status, 
     	    e.eng_name
     from SERVER s
	 left join WORKINFO W
	 on s.server_id = w.server_id
	 left join ENGINEER e
 	 on w.eng_enid = e.eng_enid
	 where s.server_id = #{server_id};
	</select>
	
	

</mapper>

